<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enhanced Weather Widget</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    background: linear-gradient(to bottom, #87CEFA, #f0f8ff);
    transition: background 0.8s;
  }
  .container {
    margin-top: 30px;
    text-align: center;
  }
  .weather-widget {
    background: rgba(255,255,255,0.95);
    border-radius: 15px;
    padding: 20px;
    width: 330px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    margin-bottom: 20px;
    transition: transform 0.4s;
  }
  .weather-widget:hover {
    transform: translateY(-3px);
  }
  h2 { margin: 0 0 10px 0; }
  input[type="text"] {
    width: 65%; padding: 6px;
    border-radius: 5px; border: 1px solid #ccc;
  }
  button {
    padding: 6px 12px; border-radius: 5px;
    border: none; background-color: #007BFF;
    color: white; cursor: pointer;
  }
  button:hover { background-color: #0056b3; }
  .current-weather { margin-top: 15px; }
  .temp { font-size: 46px; font-weight: bold; }
  .desc { font-size: 18px; }
  .icon { display: inline-block; margin-bottom: 8px; font-size: 40px; }
  .forecast {
    display: flex; justify-content: space-between;
    margin-top: 15px;
  }
  .day-card {
    background: rgba(0,0,0,0.05);
    border-radius: 10px;
    padding: 10px;
    width: 55px;
    font-size: 14px;
  }
  .day-card div { margin: 3px 0; }
  .advice-box {
    background: rgba(255,255,255,0.9);
    border-radius: 10px;
    padding: 12px;
    width: 300px;
    font-size: 14px;
    color: #333;
    line-height: 1.5;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    margin: 0 auto;
    transition: opacity 0.5s;
  }
</style>
</head>
<body>
<div class="container">
  <div class="weather-widget">
    <h2>Weather Widget</h2>
	<br>
    <input type="text" id="cityInput" placeholder="Enter city name: London, UK">
	<br><br>
    <button onclick="getWeather()">Get Weather</button>
	<br>
    <div class="current-weather" id="currentWeather">
      <div id="icon" class="icon" style="display:none;"></div>
      <div id="temp" class="temp"></div>
      <div id="desc" class="desc"></div>
      <div id="humidity"></div>
    </div>
    <div class="forecast" id="forecast"></div>
  </div>
  <div id="adviceBox" class="advice-box" style="display:none;"></div>
</div>

<audio id="bgMusic" loop autoplay>
  <source id="musicSrc" src="" type="audio/mpeg">
</audio>

<script>
// Helper: Get coordinates via Nominatim
async function getCoordinates(city) {
  const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${city}`);
  const data = await res.json();
  if (data.length === 0) return null;
  return { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon), name: data[0].display_name };
}

// Weather code mapping
function weatherCodeMap(code) {
  const map = {
    0:{desc:"Clear sky",icon:"â˜€ï¸"},
    1:{desc:"Mainly clear",icon:"ğŸŒ¤ï¸"},
    2:{desc:"Partly cloudy",icon:"â›…"},
    3:{desc:"Overcast",icon:"â˜ï¸"},
    45:{desc:"Fog",icon:"ğŸŒ«ï¸"},
    48:{desc:"Rime fog",icon:"ğŸŒ«ï¸"},
    51:{desc:"Light drizzle",icon:"ğŸŒ¦ï¸"},
    53:{desc:"Moderate drizzle",icon:"ğŸŒ¦ï¸"},
    55:{desc:"Dense drizzle",icon:"ğŸŒ§ï¸"},
    61:{desc:"Slight rain",icon:"ğŸŒ¦ï¸"},
    63:{desc:"Rain",icon:"ğŸŒ§ï¸"},
    65:{desc:"Heavy rain",icon:"ğŸŒ§ï¸"},
    71:{desc:"Slight snow",icon:"ğŸŒ¨ï¸"},
    73:{desc:"Moderate snow",icon:"ğŸŒ¨ï¸"},
    75:{desc:"Heavy snow",icon:"â„ï¸"},
    80:{desc:"Rain showers",icon:"ğŸŒ¦ï¸"},
    81:{desc:"Moderate rain showers",icon:"ğŸŒ§ï¸"},
    82:{desc:"Heavy rain showers",icon:"ğŸŒ§ï¸"},
    95:{desc:"Thunderstorm",icon:"â›ˆï¸"}
  };
  return map[code] || {desc:"Unknown",icon:"â”"};
}

// Music and background
function setMusic(code) {
  const music = document.getElementById('musicSrc');
  if (code <= 1) music.src = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';
  else if (code <= 3) music.src = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3';
  else music.src = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3';
  const player = document.getElementById('bgMusic');
  player.load(); player.play();
}

function setBackground(code) {
  const body = document.body;
  if (code <=1) body.style.background = 'linear-gradient(to bottom, #fceabb, #f8b500)';
  else if (code <=3) body.style.background = 'linear-gradient(to bottom, #d7d2cc, #304352)';
  else body.style.background = 'linear-gradient(to bottom, #4e54c8, #8f94fb)';
}

// Contextual weather advice
function getAdvice(temp, code) {
  if (code <= 1 && temp > 32) 
    return "â˜€ï¸ Itâ€™s a hot sunny day! Stay hydrated, wear sunscreen, and avoid going out during peak noon hours.";
  if (code <= 3 && temp >= 25) 
    return "ğŸŒ¤ï¸ Itâ€™s warm and clear â€” great for outdoor activities, but donâ€™t forget your sunglasses.";
  if (code >= 61 && code <= 82) 
    return "ğŸŒ§ï¸ It looks rainy! Carry an umbrella and wear waterproof shoes.";
  if (code >= 71 && code <= 75) 
    return "â„ï¸ Snowy weather! Dress warmly, drive safely, and stay cozy indoors if possible.";
  if (code >= 45 && code <= 48) 
    return "ğŸŒ«ï¸ Foggy conditions â€” visibility may be low. Drive cautiously and use fog lights.";
  if (code >= 95) 
    return "â›ˆï¸ Thunderstorms expected. Stay indoors, unplug electronics, and avoid open spaces.";
  if (temp < 15) 
    return "ğŸ§¥ Itâ€™s quite cool outside â€” wear layers and keep warm!";
  return "ğŸ˜Š Enjoy the pleasant weather â€” a perfect day to be productive or relax outdoors!";
}

// Main fetch + render
async function getWeather() {
  const city = document.getElementById('cityInput').value.trim();
  if (!city) return alert('Enter a city!');
  const coords = await getCoordinates(city);
  if (!coords) return alert('City not found!');

  const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`);
  const data = await res.json();
  const current = data.current_weather;
  const weather = weatherCodeMap(current.weathercode);

  document.getElementById('icon').style.display = 'inline';
  document.getElementById('icon').textContent = weather.icon;
  document.getElementById('temp').textContent = `${Math.round(current.temperature)}Â°C`;
  document.getElementById('desc').textContent = weather.desc;
  document.getElementById('humidity').textContent = `Wind: ${current.windspeed} km/h`;

  setBackground(current.weathercode);
  setMusic(current.weathercode);

  // Forecast
  const forecastEl = document.getElementById('forecast');
  forecastEl.innerHTML = '';
  for (let i = 0; i < 5; i++) {
    const day = new Date(data.daily.time[i]);
    const max = Math.round(data.daily.temperature_2m_max[i]);
    const min = Math.round(data.daily.temperature_2m_min[i]);
    const code = data.daily.weathercode[i];
    const info = weatherCodeMap(code);
    const card = document.createElement('div');
    card.className = 'day-card';
    card.innerHTML = `<div>${day.toLocaleDateString('en-US',{weekday:'short'})}</div>
                      <div>${info.icon}</div>
                      <div>${max}Â°/${min}Â°</div>`;
    forecastEl.appendChild(card);
  }

  // Advice section
  const advice = getAdvice(current.temperature, current.weathercode);
  const adviceBox = document.getElementById('adviceBox');
  adviceBox.innerHTML = `<b>Weather Tips:</b> ${advice}`;
  adviceBox.style.display = 'block';
}
</script>
</body>
</html>

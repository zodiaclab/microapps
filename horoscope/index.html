<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Offline Horoscope Finder</title>
  <script src="./swisseph.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: radial-gradient(circle, #1b1b1b, #000);
      color: #fff;
      padding: 20px;
      text-align: center;
    }
    h1 { color: #ffd700; }
    label, input, button { margin: 8px; font-size: 1rem; }
    input { padding: 6px; border-radius: 5px; border: none; }
    button {
      padding: 8px 15px;
      background: #ffb400;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover { background: #ffcc33; }
    .result {
      margin-top: 20px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <h1>ü™ê Offline Horoscope Finder</h1>

  <div>
    <label>Date: <input type="date" id="date" value="2025-10-01"></label>
    <label>Time: <input type="time" id="time" value="12:00"></label><br>
    <label>Latitude: <input type="number" id="lat" value="13.08"></label>
    <label>Longitude: <input type="number" id="lon" value="80.27"></label>
    <label>Timezone: <input type="number" id="tz" step="0.5" value="5.5"></label>
  </div>

  <button onclick="computeHoroscope()">Get Horoscope</button>

  <div id="result" class="result"></div>

  <script>
    const RASI_NAMES = [
      "Mesha (Aries)", "Rishabha (Taurus)", "Mithuna (Gemini)",
      "Karka (Cancer)", "Simha (Leo)", "Kanya (Virgo)",
      "Tula (Libra)", "Vrischika (Scorpio)", "Dhanus (Sagittarius)",
      "Makara (Capricorn)", "Kumbha (Aquarius)", "Meena (Pisces)"
    ];

    async function computeHoroscope() {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = "Loading Swiss Ephemeris...";

      const [yyyy, mm, dd] = document.getElementById('date').value.split('-').map(Number);
      const [hh, mi] = document.getElementById('time').value.split(':').map(Number);
      const lat = parseFloat(document.getElementById('lat').value);
      const lon = parseFloat(document.getElementById('lon').value);
      const tz = parseFloat(document.getElementById('tz').value);

      try {
        await swisseph.init({
          ephemerisPath: './ephemeris/',
          wasmFile: './swisseph.wasm'
        });

        // Convert to Universal Time
        const utHour = hh - tz + (mi / 60);
        const julDayUT = swisseph.swe_julday(yyyy, mm, dd, utHour, swisseph.SE_GREG_CAL);

        // Get Moon longitude
        const moon = swisseph.swe_calc_ut(julDayUT, swisseph.SE_MOON, 0);
        const moonLon = moon.longitude;

        // Determine Rasi (12 signs, 30¬∞ each)
        const rasiIndex = Math.floor(moonLon / 30);
        const rasi = RASI_NAMES[rasiIndex];

        // Determine Western zodiac (Sun sign)
        const sun = swisseph.swe_calc_ut(julDayUT, swisseph.SE_SUN, 0);
        const sunLon = sun.longitude;
        const westZodiac = RASI_NAMES[Math.floor(sunLon / 30)].split(' ')[0];

        resultDiv.innerHTML = `
          <h3>üåì Horoscope Results</h3>
          <p><b>Vedic (Moon / Rasi):</b> ${rasi}</p>
          <p><b>Western (Sun Sign):</b> ${westZodiac}</p>
          <p><b>Moon Longitude:</b> ${moonLon.toFixed(2)}¬∞</p>
          <p><b>Sun Longitude:</b> ${sunLon.toFixed(2)}¬∞</p>
        `;
      } catch (err) {
        console.error(err);
        resultDiv.innerHTML = "‚ùå Swiss Ephemeris initialization failed. Check console for details.";
      }
    }
  </script>
</body>
</html>
